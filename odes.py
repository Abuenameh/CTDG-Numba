
import numpy as np
from parms import g, U0t, Ut, Jt, U0tp, Jtp, Wt, Wtp
from numba import jit, int64, float64, complex128


@jit(complex128(complex128[:,:],int64,int64,int64,int64,float64,float64,float64[:],float64[:],float64,float64[:]), nopython=True, cache=True)
def S1dtdf(f, id, nd, L, nmax, mu, U0, dU, J, U0p, Jp):
	Edff = 0
	for i in range(L):
		j1 = (i-1) % L
		j2 = (i+1) % L
		for n in range(nmax):
			for m in range(1, nmax+1):
				if n != m-1:
					if (id == i and nd == 1 + n):
						Edff += U0p*f[j2,-1 + m].conjugate()*f[i,n]*f[j2,m]*g(n,m)*J[i]*pow(1 - m + n,-1.)*pow(U0,-2.) + U0p*f[j1,-1 + m].conjugate()*f[i,n]*f[j1,m]*g(n,m)*J[j1]*pow(1 - m + n,-1.)*pow(U0,-2.) - f[j2,-1 + m].conjugate()*f[i,n]*f[j2,m]*g(n,m)*Jp[i]*pow(1 - m + n,-1.)*pow(U0,-1.) - f[j1,-1 + m].conjugate()*f[i,n]*f[j1,m]*g(n,m)*Jp[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
					if (id == j1 and nd == -1 + m):
						Edff += U0p*f[i,1 + n].conjugate()*f[i,n]*f[j1,m]*g(n,m)*J[j1]*pow(1 - m + n,-1.)*pow(U0,-2.) - f[i,1 + n].conjugate()*f[i,n]*f[j1,m]*g(n,m)*Jp[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
					if (id == j2 and nd == -1 + m):
						Edff += U0p*f[i,1 + n].conjugate()*f[i,n]*f[j2,m]*g(n,m)*J[i]*pow(1 - m + n,-1.)*pow(U0,-2.) - f[i,1 + n].conjugate()*f[i,n]*f[j2,m]*g(n,m)*Jp[i]*pow(1 - m + n,-1.)*pow(U0,-1.)
	return Edff

@jit(complex128(complex128[:,:],int64,int64,int64,int64,float64,float64,float64[:],float64[:]), nopython=True, cache=True)
def Edf1(f, id, nd, i, n, mu, U0, dU, J):
	Edff = 0
	if (id == i and nd == n):
		Edff += -(mu*n*f[i,n]) - 0.5*n*U0*f[i,n] - 0.5*n*dU[i]*f[i,n] + 0.5*U0*f[i,n]*pow(n,2.) + 0.5*dU[i]*f[i,n]*pow(n,2.)
	return Edff

@jit(complex128(complex128[:,:],int64,int64,int64,int64,int64,int64,float64,float64,float64[:],float64[:]), nopython=True, cache=True)
def Edf2(f, id, nd, i, j1, j2, n, mu, U0, dU, J):
	Edff = 0
	if (id == i and nd == 1 + n):
		Edff += -(f[j2,n].conjugate()*f[i,n]*f[j2,1 + n]*g(n,1 + n)*J[i]) - f[j1,n].conjugate()*f[i,n]*f[j1,1 + n]*g(n,1 + n)*J[j1]
	if (id == j1 and nd == n):
		Edff += -(f[i,1 + n].conjugate()*f[i,n]*f[j1,1 + n]*g(n,1 + n)*J[j1])
	if (id == j2 and nd == n):
		Edff += -(f[i,1 + n].conjugate()*f[i,n]*f[j2,1 + n]*g(n,1 + n)*J[i])
	return Edff

@jit(complex128(complex128[:,:],int64,int64,int64,int64,int64,int64,int64,float64,float64,float64[:],float64[:]), nopython=True, cache=True)
def Edf3(f, id, nd, i, j1, j2, n, m, mu, U0, dU, J):
	Edff = 0
	if (id == i and nd == 1 + n):
		Edff += -(n*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*J[i]*pow(1 - m + n,-1.)*pow(U0,-1.)) - f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*J[i]*pow(1 - m + n,-1.)*pow(U0,-1.) + m*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*J[i]*pow(1 - m + n,-1.)*pow(U0,-1.) - n*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.) - f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.) + m*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
	if (id == j1 and nd == -1 + m):
		Edff += -(n*f[i,1 + n].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)) - f[i,1 + n].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.) + m*f[i,1 + n].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
	if (id == j2 and nd == -1 + m):
		Edff += -(n*f[i,1 + n].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*J[i]*pow(1 - m + n,-1.)*pow(U0,-1.)) - f[i,1 + n].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*J[i]*pow(1 - m + n,-1.)*pow(U0,-1.) + m*f[i,1 + n].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*J[i]*pow(1 - m + n,-1.)*pow(U0,-1.)
	return Edff

@jit(complex128(complex128[:,:],int64,int64,int64,int64,int64,int64,int64,int64,int64,int64,float64,float64,float64[:],float64[:]), nopython=True, cache=True)
def Edf4(f, id, nd, i, j1, j2, k1, k2, n, m, p, mu, U0, dU, J):
	Edff = 0
	if (id == i and nd == 1 + n):
		if (m == p and n == 1 + p):
			Edff += -(n*f[j1,-1 + m].conjugate()*dU[i]*f[i,p]*f[j1,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.)) - p*f[j1,-1 + m].conjugate()*dU[i]*f[i,p]*f[j1,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) - f[j1,-1 + m].conjugate()*dU[j1]*f[i,p]*f[j1,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) + m*f[j1,-1 + m].conjugate()*dU[j1]*f[i,p]*f[j1,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) + p*f[j1,-1 + m].conjugate()*dU[j1]*f[i,p]*f[j1,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.)
		
		if (m == p and n == 1 + p):
			Edff += -(n*f[j2,-1 + m].conjugate()*dU[i]*f[i,p]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.)) - p*f[j2,-1 + m].conjugate()*dU[i]*f[i,p]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) - f[j2,-1 + m].conjugate()*dU[j2]*f[i,p]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) + m*f[j2,-1 + m].conjugate()*dU[j2]*f[i,p]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) + p*f[j2,-1 + m].conjugate()*dU[j2]*f[i,p]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.)
		
		if (n == p and m == 1 + p):
			Edff += -(n*f[j1,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.)) + p*f[j1,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) - f[j1,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) + m*f[j1,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) - p*f[j1,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.)
		
		if (n == p and m == 1 + p):
			Edff += -(n*f[j2,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j2,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.)) + p*f[j2,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j2,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) - f[j2,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j2,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) + m*f[j2,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j2,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) - p*f[j2,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j2,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.)
		
		if (n == 1 + p):
			Edff += -(n*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,p]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)) - p*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,p]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,p]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,p]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,p]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (n == 1 + p):
			Edff += -(n*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,p]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)) - p*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,p]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[j1]*f[i,p]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[j1]*f[i,p]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,p]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (m == 1 + p):
			Edff += n*f[j1,1 + p].conjugate()*f[k1,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[j1,1 + p].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[j1,1 + p].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[j1,1 + p].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[j1,1 + p].conjugate()*f[k1,p].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - n*f[j1,-1 + m].conjugate()*f[k1,p].conjugate()*dU[i]*f[i,n]*f[j1,p]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - f[j1,-1 + m].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,p]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[j1,-1 + m].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,p]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[j1,-1 + m].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,p]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[j1,-1 + m].conjugate()*f[k1,p].conjugate()*dU[k1]*f[i,n]*f[j1,p]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (m == 1 + p):
			Edff += n*f[j2,1 + p].conjugate()*f[k2,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[j2,1 + p].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[j2,1 + p].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[j2,1 + p].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[j2,1 + p].conjugate()*f[k2,p].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - n*f[j2,-1 + m].conjugate()*f[k2,p].conjugate()*dU[i]*f[i,n]*f[j2,p]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - f[j2,-1 + m].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,p]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[j2,-1 + m].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,p]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[j2,-1 + m].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,p]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[j2,-1 + m].conjugate()*f[k2,p].conjugate()*dU[k2]*f[i,n]*f[j2,p]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (n == p):
			Edff += -(n*f[j1,-1 + m].conjugate()*f[j2,1 + p].conjugate()*dU[i]*f[i,1 + p]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)) + p*f[j1,-1 + m].conjugate()*f[j2,1 + p].conjugate()*dU[i]*f[i,1 + p]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - f[j1,-1 + m].conjugate()*f[j2,1 + p].conjugate()*dU[j1]*f[i,1 + p]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[j1,-1 + m].conjugate()*f[j2,1 + p].conjugate()*dU[j1]*f[i,1 + p]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[j1,-1 + m].conjugate()*f[j2,1 + p].conjugate()*dU[j2]*f[i,1 + p]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (n == p):
			Edff += -(n*f[j1,1 + p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)) + p*f[j1,1 + p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[j1,1 + p].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - f[j1,1 + p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[j1,1 + p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (m == p):
			Edff += -(n*f[j1,-1 + m].conjugate()*f[k1,1 + p].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.)) - f[j1,-1 + m].conjugate()*f[k1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[j1,-1 + m].conjugate()*f[k1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[j1,-1 + m].conjugate()*f[k1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[j1,-1 + m].conjugate()*f[k1,1 + p].conjugate()*dU[k1]*f[i,n]*f[j1,1 + p]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		if (m == 2 + p):
			Edff += n*f[j1,p].conjugate()*f[k1,1 + p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[j1,p].conjugate()*f[k1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[j1,p].conjugate()*f[k1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[j1,p].conjugate()*f[k1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[j1,p].conjugate()*f[k1,1 + p].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (m == p):
			Edff += -(n*f[j2,-1 + m].conjugate()*f[k2,1 + p].conjugate()*dU[i]*f[i,n]*f[j2,1 + p]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.)) - f[j2,-1 + m].conjugate()*f[k2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[j2,-1 + m].conjugate()*f[k2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[j2,-1 + m].conjugate()*f[k2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[j2,-1 + m].conjugate()*f[k2,1 + p].conjugate()*dU[k2]*f[i,n]*f[j2,1 + p]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.)
		if (m == 2 + p):
			Edff += n*f[j2,p].conjugate()*f[k2,1 + p].conjugate()*dU[i]*f[i,n]*f[j2,m]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[j2,p].conjugate()*f[k2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[j2,p].conjugate()*f[k2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[j2,p].conjugate()*f[k2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[j2,p].conjugate()*f[k2,1 + p].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.)
	if (id == i and nd == p):
		if (n == p and m == 1 + p):
			Edff += n*f[j1,1 + p].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) - p*f[j1,1 + p].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) + f[j1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) - m*f[j1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) + p*f[j1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.)
		
		if (n == p and m == 1 + p):
			Edff += n*f[j2,1 + p].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) - p*f[j2,1 + p].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) + f[j2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) - m*f[j2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) + p*f[j2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.)
		
		if (n == p):
			Edff += n*f[j1,-1 + m].conjugate()*f[j2,1 + p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[j1,-1 + m].conjugate()*f[j2,1 + p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[j1,-1 + m].conjugate()*f[j2,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[j1,-1 + m].conjugate()*f[j2,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[j1,-1 + m].conjugate()*f[j2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (n == p):
			Edff += n*f[j1,1 + p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[j1,1 + p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[j1,1 + p].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[j1,1 + p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[j1,1 + p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
	if (id == i and nd == 1 + p):
		if (1 + n == p and m == 2 + p):
			Edff += n*f[j1,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) + p*f[j1,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) + f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) - m*f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) - p*f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.)
		
		if (1 + n == p and m == 2 + p):
			Edff += n*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) + p*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) + f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) - m*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) - p*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.)
		
		if (1 + n == p):
			Edff += n*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (1 + n == p):
			Edff += n*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
	if (id == j1 and nd == -1 + m):
		if (m == p and n == 1 + p):
			Edff += -(n*f[i,1 + n].conjugate()*dU[i]*f[i,p]*f[j1,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.)) - p*f[i,1 + n].conjugate()*dU[i]*f[i,p]*f[j1,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) - f[i,1 + n].conjugate()*dU[j1]*f[i,p]*f[j1,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) + m*f[i,1 + n].conjugate()*dU[j1]*f[i,p]*f[j1,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) + p*f[i,1 + n].conjugate()*dU[j1]*f[i,p]*f[j1,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.)
		
		if (n == p and m == 1 + p):
			Edff += -(n*f[i,1 + n].conjugate()*dU[i]*f[i,1 + p]*f[j1,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.)) + p*f[i,1 + n].conjugate()*dU[i]*f[i,1 + p]*f[j1,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) - f[i,1 + n].conjugate()*dU[j1]*f[i,1 + p]*f[j1,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) + m*f[i,1 + n].conjugate()*dU[j1]*f[i,1 + p]*f[j1,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) - p*f[i,1 + n].conjugate()*dU[j1]*f[i,1 + p]*f[j1,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.)
		
		if (1 + n == p):
			Edff += n*f[i,1 + p].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + p].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[i,1 + p].conjugate()*f[j2,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[i,1 + p].conjugate()*f[j2,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + p].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		if (n == 1 + p):
			Edff += -(n*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,p]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)) - p*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,p]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[j1]*f[i,p]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[j1]*f[i,p]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,p]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (m == 1 + p):
			Edff += -(n*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[i]*f[i,n]*f[j1,p]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.)) - f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,p]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,p]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,p]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[k1]*f[i,n]*f[j1,p]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (n == p):
			Edff += n*f[i,p].conjugate()*f[j2,1 + p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,p].conjugate()*f[j2,1 + p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[i,p].conjugate()*f[j2,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[i,p].conjugate()*f[j2,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,p].conjugate()*f[j2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - n*f[i,1 + n].conjugate()*f[j2,1 + p].conjugate()*dU[i]*f[i,1 + p]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[j2,1 + p].conjugate()*dU[i]*f[i,1 + p]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - f[i,1 + n].conjugate()*f[j2,1 + p].conjugate()*dU[j1]*f[i,1 + p]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[i,1 + n].conjugate()*f[j2,1 + p].conjugate()*dU[j1]*f[i,1 + p]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[j2,1 + p].conjugate()*dU[j2]*f[i,1 + p]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (m == p):
			Edff += -(n*f[i,1 + n].conjugate()*f[k1,1 + p].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.)) - f[i,1 + n].conjugate()*f[k1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[i,1 + n].conjugate()*f[k1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[k1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[k1,1 + p].conjugate()*dU[k1]*f[i,n]*f[j1,1 + p]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.)
	if (id == j1 and nd == p):
		if (1 + n == p and m == 2 + p):
			Edff += n*f[i,1 + p].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) + p*f[i,1 + p].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) + f[i,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) - m*f[i,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) - p*f[i,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.)
		
		if (1 + n == p):
			Edff += n*f[i,1 + p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + p].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[i,1 + p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[i,1 + p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		if (n == 1 + p):
			Edff += -(n*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,p]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)) - p*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,p]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,p]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,p]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,p]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (m == 2 + p):
			Edff += n*f[i,1 + n].conjugate()*f[k1,1 + p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[i,1 + n].conjugate()*f[k1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[i,1 + n].conjugate()*f[k1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[k1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[k1,1 + p].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.)
	if (id == j1 and nd == 1 + p):
		if (n == p and m == 1 + p):
			Edff += n*f[i,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) - p*f[i,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) + f[i,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) - m*f[i,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.) + p*f[i,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[j1],2.)
		
		if (m == 1 + p):
			Edff += n*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (n == p):
			Edff += n*f[i,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[i,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[i,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - n*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
	if (id == j2 and nd == -1 + m):
		if (m == p and n == 1 + p):
			Edff += -(n*f[i,1 + n].conjugate()*dU[i]*f[i,p]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.)) - p*f[i,1 + n].conjugate()*dU[i]*f[i,p]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) - f[i,1 + n].conjugate()*dU[j2]*f[i,p]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) + m*f[i,1 + n].conjugate()*dU[j2]*f[i,p]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) + p*f[i,1 + n].conjugate()*dU[j2]*f[i,p]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.)
		
		if (n == p and m == 1 + p):
			Edff += -(n*f[i,1 + n].conjugate()*dU[i]*f[i,1 + p]*f[j2,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.)) + p*f[i,1 + n].conjugate()*dU[i]*f[i,1 + p]*f[j2,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) - f[i,1 + n].conjugate()*dU[j2]*f[i,1 + p]*f[j2,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) + m*f[i,1 + n].conjugate()*dU[j2]*f[i,1 + p]*f[j2,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) - p*f[i,1 + n].conjugate()*dU[j2]*f[i,1 + p]*f[j2,p]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.)
		
		if (1 + n == p):
			Edff += n*f[i,1 + p].conjugate()*f[j1,p].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + p].conjugate()*f[j1,p].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + p].conjugate()*f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[i,1 + p].conjugate()*f[j1,p].conjugate()*dU[j2]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[i,1 + p].conjugate()*f[j1,p].conjugate()*dU[j2]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		if (n == 1 + p):
			Edff += -(n*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[i]*f[i,p]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)) - p*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[i]*f[i,p]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[j1]*f[i,p]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[j2]*f[i,p]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[j2]*f[i,p]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (m == 1 + p):
			Edff += -(n*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[i]*f[i,n]*f[j2,p]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.)) - f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,p]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,p]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,p]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[k2]*f[i,n]*f[j2,p]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (n == p):
			Edff += n*f[i,p].conjugate()*f[j1,1 + p].conjugate()*dU[i]*f[i,n]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,p].conjugate()*f[j1,1 + p].conjugate()*dU[i]*f[i,n]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,p].conjugate()*f[j1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[i,p].conjugate()*f[j1,1 + p].conjugate()*dU[j2]*f[i,n]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[i,p].conjugate()*f[j1,1 + p].conjugate()*dU[j2]*f[i,n]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - n*f[i,1 + n].conjugate()*f[j1,1 + p].conjugate()*dU[i]*f[i,1 + p]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[j1,1 + p].conjugate()*dU[i]*f[i,1 + p]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[j1,1 + p].conjugate()*dU[j1]*f[i,1 + p]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - f[i,1 + n].conjugate()*f[j1,1 + p].conjugate()*dU[j2]*f[i,1 + p]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[i,1 + n].conjugate()*f[j1,1 + p].conjugate()*dU[j2]*f[i,1 + p]*f[j1,p]*f[j2,m]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (m == p):
			Edff += -(n*f[i,1 + n].conjugate()*f[k2,1 + p].conjugate()*dU[i]*f[i,n]*f[j2,1 + p]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.)) - f[i,1 + n].conjugate()*f[k2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[i,1 + n].conjugate()*f[k2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[k2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[k2,1 + p].conjugate()*dU[k2]*f[i,n]*f[j2,1 + p]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.)
	if (id == j2 and nd == p):
		if (1 + n == p and m == 2 + p):
			Edff += n*f[i,1 + p].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) + p*f[i,1 + p].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) + f[i,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) - m*f[i,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) - p*f[i,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.)
		
		if (1 + n == p):
			Edff += n*f[i,1 + p].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + p].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[i,1 + p].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[i,1 + p].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + p].conjugate()*f[j1,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		if (n == 1 + p):
			Edff += -(n*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,p]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)) - p*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,p]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,p]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,p]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j2]*f[i,p]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (m == 2 + p):
			Edff += n*f[i,1 + n].conjugate()*f[k2,1 + p].conjugate()*dU[i]*f[i,n]*f[j2,m]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[i,1 + n].conjugate()*f[k2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[i,1 + n].conjugate()*f[k2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[k2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[k2,1 + p].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.)
	if (id == j2 and nd == 1 + p):
		if (n == p and m == 1 + p):
			Edff += n*f[i,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) - p*f[i,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) + f[i,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) - m*f[i,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.) + p*f[i,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(p,1 + p)*pow(1 - m + n,-2.)*pow(U0,-2.)*pow(J[i],2.)
		
		if (m == 1 + p):
			Edff += n*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.)
		
		if (n == p):
			Edff += n*f[i,p].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,p].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[i,p].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[i,p].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,p].conjugate()*f[j1,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - n*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j1,m]*f[j2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j1]*pow(1 - m + n,-2.)*pow(U0,-2.)
	if (id == k1 and nd == p):
		if (m == 1 + p):
			Edff += n*f[i,1 + n].conjugate()*f[j1,1 + p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[i,1 + n].conjugate()*f[j1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[i,1 + n].conjugate()*f[j1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[j1,1 + p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[j1,1 + p].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - n*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,p]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,p]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,p]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,p]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[k1]*f[i,n]*f[j1,p]*f[k1,1 + p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.)
	if (id == k1 and nd == 1 + p):
		if (m == p):
			Edff += -(n*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.)) - f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[k1]*f[i,n]*f[j1,1 + p]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.)
		if (m == 2 + p):
			Edff += n*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,p]*g(n,m)*g(p,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-2.)*pow(U0,-2.)
	if (id == k2 and nd == p):
		if (m == 1 + p):
			Edff += n*f[i,1 + n].conjugate()*f[j2,1 + p].conjugate()*dU[i]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[i,1 + n].conjugate()*f[j2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[i,1 + n].conjugate()*f[j2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[j2,1 + p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[j2,1 + p].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - n*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j2,p]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j2,p]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j2,p]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j2,p]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[k2]*f[i,n]*f[j2,p]*f[k2,1 + p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.)
	if (id == k2 and nd == 1 + p):
		if (m == p):
			Edff += -(n*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j2,1 + p]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.)) - f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + m*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[k2]*f[i,n]*f[j2,1 + p]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.)
		if (m == 2 + p):
			Edff += n*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - m*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) - p*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.) + p*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,p]*g(n,m)*g(p,1 + p)*J[i]*J[j2]*pow(1 - m + n,-2.)*pow(U0,-2.)
	return Edff

@jit(complex128(complex128[:,:],int64,int64,int64,int64,int64,int64,int64,int64,int64,int64,int64,float64,float64,float64[:],float64[:]), nopython=True, cache=True)
def Edf5(f, id, nd, i, j1, j2, k1, k2, n, m, p, q, mu, U0, dU, J):
	Edff = 0
	if (id == i and nd == 1 + n):
		if (m == p and n == q):
			Edff += 0.5*f[j1,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.) - 0.5*q*f[j1,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.) + 0.5*p*f[j1,-1 + m].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.)
		
		if (m == p and n == q):
			Edff += 0.5*f[j2,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.) - 0.5*q*f[j2,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.) + 0.5*p*f[j2,-1 + m].conjugate()*dU[j2]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.)
		
		if (n == p and m == q):
			Edff += 0.5*p*f[j1,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.) + 0.5*f[j1,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.) - 0.5*q*f[j1,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.)
		
		if (n == p and m == q):
			Edff += 0.5*p*f[j2,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.) + 0.5*f[j2,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.) - 0.5*q*f[j2,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.)
		
		if (n == q):
			Edff += 0.5*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*p*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (n == q):
			Edff += 0.5*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*p*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (m == q):
			Edff += -0.5*f[j1,q].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[j1,q].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*p*f[j1,q].conjugate()*f[k1,p].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*f[j1,-1 + m].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[j1,-1 + m].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*p*f[j1,-1 + m].conjugate()*f[k1,p].conjugate()*dU[k1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (m == q):
			Edff += -0.5*f[j2,q].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[j2,q].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*p*f[j2,q].conjugate()*f[k2,p].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*f[j2,-1 + m].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[j2,-1 + m].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*p*f[j2,-1 + m].conjugate()*f[k2,p].conjugate()*dU[k2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (n == p):
			Edff += 0.5*p*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[i]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (n == p):
			Edff += 0.5*p*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (m == p):
			Edff += 0.5*p*f[j1,-1 + m].conjugate()*f[k1,q].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*f[j1,-1 + m].conjugate()*f[k1,q].conjugate()*dU[k1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[j1,-1 + m].conjugate()*f[k1,q].conjugate()*dU[k1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		if (m == 2 + p):
			Edff += -0.5*p*f[j1,p].conjugate()*f[k1,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*f[j1,p].conjugate()*f[k1,q].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[j1,p].conjugate()*f[k1,q].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (m == p):
			Edff += 0.5*p*f[j2,-1 + m].conjugate()*f[k2,q].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*f[j2,-1 + m].conjugate()*f[k2,q].conjugate()*dU[k2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[j2,-1 + m].conjugate()*f[k2,q].conjugate()*dU[k2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		if (m == 2 + p):
			Edff += -0.5*p*f[j2,p].conjugate()*f[k2,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*f[j2,p].conjugate()*f[k2,q].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[j2,p].conjugate()*f[k2,q].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
	if (id == i and nd == p):
		if (n == p and m == q):
			Edff += -0.5*p*f[j1,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.) - 0.5*f[j1,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.) + 0.5*q*f[j1,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.)
		
		if (n == p and m == q):
			Edff += -0.5*p*f[j2,q].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.) - 0.5*f[j2,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.) + 0.5*q*f[j2,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.)
		
		if (n == p):
			Edff += -0.5*p*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (n == p):
			Edff += -0.5*p*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
	if (id == i and nd == q):
		if (m == 2 + p and 2 + n == q):
			Edff += -0.5*f[j1,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.) + 0.5*q*f[j1,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.) - 0.5*p*f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.)
		
		if (m == 2 + p and 2 + n == q):
			Edff += -0.5*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.) + 0.5*q*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.) - 0.5*p*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.)
		
		if (2 + n == q):
			Edff += -0.5*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*p*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (2 + n == q):
			Edff += -0.5*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*p*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
	if (id == j1 and nd == -1 + m):
		if (m == p and n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.) - 0.5*q*f[i,1 + n].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.) + 0.5*p*f[i,1 + n].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.)
		
		if (n == p and m == q):
			Edff += 0.5*p*f[i,1 + n].conjugate()*dU[i]*f[i,1 + p]*f[j1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.) + 0.5*f[i,1 + n].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.) - 0.5*q*f[i,1 + n].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.)
		
		if (n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*p*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		if (2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[i,q].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*p*f[i,q].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (m == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*p*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[k1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (n == p):
			Edff += -0.5*p*f[i,p].conjugate()*f[j2,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*f[i,p].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[i,p].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*p*f[i,1 + n].conjugate()*f[j2,q].conjugate()*dU[i]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*f[i,1 + n].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[i,1 + n].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (m == p):
			Edff += 0.5*p*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[k1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[k1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
	if (id == j1 and nd == p):
		if (m == 2 + p and 2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.) + 0.5*q*f[i,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.) - 0.5*p*f[i,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.)
		
		if (n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*p*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		if (2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[i,q].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*p*f[i,q].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (m == 2 + p):
			Edff += -0.5*p*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
	if (id == j1 and nd == q):
		if (n == p and m == q):
			Edff += -0.5*p*f[i,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.) - 0.5*f[i,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.) + 0.5*q*f[i,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[j1],2.)
		
		if (m == q):
			Edff += -0.5*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*p*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (n == p):
			Edff += -0.5*p*f[i,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*f[i,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[i,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*p*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
	if (id == j2 and nd == -1 + m):
		if (m == p and n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*dU[i]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.) - 0.5*q*f[i,1 + n].conjugate()*dU[i]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.) + 0.5*p*f[i,1 + n].conjugate()*dU[j2]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.)
		
		if (n == p and m == q):
			Edff += 0.5*p*f[i,1 + n].conjugate()*dU[i]*f[i,1 + p]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.) + 0.5*f[i,1 + n].conjugate()*dU[j2]*f[i,1 + p]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.) - 0.5*q*f[i,1 + n].conjugate()*dU[j2]*f[i,1 + p]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.)
		
		if (n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*p*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		if (2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*f[j1,p].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[i,q].conjugate()*f[j1,p].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*p*f[i,q].conjugate()*f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (m == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*p*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[k2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (n == p):
			Edff += -0.5*p*f[i,p].conjugate()*f[j1,q].conjugate()*dU[i]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*f[i,p].conjugate()*f[j1,q].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[i,p].conjugate()*f[j1,q].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*p*f[i,1 + n].conjugate()*f[j1,q].conjugate()*dU[i]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*f[i,1 + n].conjugate()*f[j1,q].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[i,1 + n].conjugate()*f[j1,q].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (m == p):
			Edff += 0.5*p*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[k2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[k2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
	if (id == j2 and nd == p):
		if (m == 2 + p and 2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.) + 0.5*q*f[i,q].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.) - 0.5*p*f[i,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.)
		
		if (n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*p*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j2]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		if (2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[i,q].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*p*f[i,q].conjugate()*f[j1,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (m == 2 + p):
			Edff += -0.5*p*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
	if (id == j2 and nd == q):
		if (n == p and m == q):
			Edff += -0.5*p*f[i,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.) - 0.5*f[i,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.) + 0.5*q*f[i,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)*pow(J[i],2.)
		
		if (m == q):
			Edff += -0.5*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*p*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		
		if (n == p):
			Edff += -0.5*p*f[i,p].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*f[i,p].conjugate()*f[j1,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[i,p].conjugate()*f[j1,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*p*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
	if (id == k1 and nd == p):
		if (m == q):
			Edff += -0.5*f[i,1 + n].conjugate()*f[j1,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[i,1 + n].conjugate()*f[j1,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*p*f[i,1 + n].conjugate()*f[j1,q].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*p*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[k1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
	if (id == k1 and nd == q):
		if (m == p):
			Edff += 0.5*p*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[k1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[k1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		if (m == 2 + p):
			Edff += -0.5*p*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
	if (id == k2 and nd == p):
		if (m == q):
			Edff += -0.5*f[i,1 + n].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[i,1 + n].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*p*f[i,1 + n].conjugate()*f[j2,q].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*p*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[k2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
	if (id == k2 and nd == q):
		if (m == p):
			Edff += 0.5*p*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[k2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*q*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[k2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
		if (m == 2 + p):
			Edff += -0.5*p*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) - 0.5*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.) + 0.5*q*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(-1 - p + q,-1.)*pow(U0,-2.)
	return Edff

@jit(complex128(complex128[:,:],int64,int64,int64,int64,int64,int64,int64,int64,int64,int64,int64,float64,float64,float64[:],float64[:]), nopython=True, cache=True)
def Edf6(f, id, nd, i, j1, j2, k1, k2, n, m, p, q, mu, U0, dU, J):
	Edff = 0
	if (id == i and nd == 1 + n):
		if (m == p and n == q):
			Edff += 0.5*f[j1,-1 + m].conjugate()*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow(J[j1],2.)
		
		if (m == p and n == q):
			Edff += 0.5*f[j2,-1 + m].conjugate()*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow(J[i],2.)
		
		if (n == p and m == q):
			Edff += 0.5*f[j1,-1 + m].conjugate()*f[i,1 + p]*f[j1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow(J[j1],2.)
		
		if (n == p and m == q):
			Edff += 0.5*f[j2,-1 + m].conjugate()*f[i,1 + p]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow(J[i],2.)
		
		if (n == q):
			Edff += 0.5*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (n == q):
			Edff += 0.5*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (m == q):
			Edff += -0.5*f[j1,q].conjugate()*f[k1,p].conjugate()*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.) + 0.5*f[j1,-1 + m].conjugate()*f[k1,p].conjugate()*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (m == q):
			Edff += -0.5*f[j2,q].conjugate()*f[k2,p].conjugate()*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.) + 0.5*f[j2,-1 + m].conjugate()*f[k2,p].conjugate()*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (n == p):
			Edff += 0.5*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (n == p):
			Edff += 0.5*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (m == p):
			Edff += 0.5*f[j1,-1 + m].conjugate()*f[k1,q].conjugate()*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		if (m == 2 + p):
			Edff += -0.5*f[j1,p].conjugate()*f[k1,q].conjugate()*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (m == p):
			Edff += 0.5*f[j2,-1 + m].conjugate()*f[k2,q].conjugate()*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)
		if (m == 2 + p):
			Edff += -0.5*f[j2,p].conjugate()*f[k2,q].conjugate()*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)
	if (id == i and nd == p):
		if (n == p and m == q):
			Edff += -0.5*f[j1,q].conjugate()*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow(J[j1],2.)
		
		if (n == p and m == q):
			Edff += -0.5*f[j2,q].conjugate()*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow(J[i],2.)
		
		if (n == p):
			Edff += -0.5*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (n == p):
			Edff += -0.5*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
	if (id == i and nd == q):
		if (m == 2 + p and 2 + n == q):
			Edff += -0.5*f[j1,p].conjugate()*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow(J[j1],2.)
		
		if (m == 2 + p and 2 + n == q):
			Edff += -0.5*f[j2,p].conjugate()*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow(J[i],2.)
		
		if (2 + n == q):
			Edff += -0.5*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (2 + n == q):
			Edff += -0.5*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
	if (id == j1 and nd == -1 + m):
		if (m == p and n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow(J[j1],2.)
		
		if (n == p and m == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[i,1 + p]*f[j1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow(J[j1],2.)
		
		if (n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[j2,p].conjugate()*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		if (2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*f[j2,p].conjugate()*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (m == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[k1,p].conjugate()*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (n == p):
			Edff += -0.5*f[i,p].conjugate()*f[j2,q].conjugate()*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[j2,q].conjugate()*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (m == p):
			Edff += 0.5*f[i,1 + n].conjugate()*f[k1,q].conjugate()*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)
	if (id == j1 and nd == p):
		if (m == 2 + p and 2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow(J[j1],2.)
		
		if (n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		if (2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*f[j2,-1 + m].conjugate()*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (m == 2 + p):
			Edff += -0.5*f[i,1 + n].conjugate()*f[k1,q].conjugate()*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)
	if (id == j1 and nd == q):
		if (n == p and m == q):
			Edff += -0.5*f[i,p].conjugate()*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow(J[j1],2.)
		
		if (m == q):
			Edff += -0.5*f[i,1 + n].conjugate()*f[k1,p].conjugate()*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (n == p):
			Edff += -0.5*f[i,p].conjugate()*f[j2,-1 + m].conjugate()*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
	if (id == j2 and nd == -1 + m):
		if (m == p and n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow(J[i],2.)
		
		if (n == p and m == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[i,1 + p]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow(J[i],2.)
		
		if (n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[j1,p].conjugate()*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		if (2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*f[j1,p].conjugate()*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (m == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[k2,p].conjugate()*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (n == p):
			Edff += -0.5*f[i,p].conjugate()*f[j1,q].conjugate()*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[j1,q].conjugate()*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (m == p):
			Edff += 0.5*f[i,1 + n].conjugate()*f[k2,q].conjugate()*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)
	if (id == j2 and nd == p):
		if (m == 2 + p and 2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow(J[i],2.)
		
		if (n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		if (2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*f[j1,-1 + m].conjugate()*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (m == 2 + p):
			Edff += -0.5*f[i,1 + n].conjugate()*f[k2,q].conjugate()*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)
	if (id == j2 and nd == q):
		if (n == p and m == q):
			Edff += -0.5*f[i,p].conjugate()*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow(J[i],2.)
		
		if (m == q):
			Edff += -0.5*f[i,1 + n].conjugate()*f[k2,p].conjugate()*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)
		
		if (n == p):
			Edff += -0.5*f[i,p].conjugate()*f[j1,-1 + m].conjugate()*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)
	if (id == k1 and nd == p):
		if (m == q):
			Edff += -0.5*f[i,1 + n].conjugate()*f[j1,q].conjugate()*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)
	if (id == k1 and nd == q):
		if (m == p):
			Edff += 0.5*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)
		if (m == 2 + p):
			Edff += -0.5*f[i,1 + n].conjugate()*f[j1,p].conjugate()*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)
	if (id == k2 and nd == p):
		if (m == q):
			Edff += -0.5*f[i,1 + n].conjugate()*f[j2,q].conjugate()*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)
	if (id == k2 and nd == q):
		if (m == p):
			Edff += 0.5*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)
		if (m == 2 + p):
			Edff += -0.5*f[i,1 + n].conjugate()*f[j2,p].conjugate()*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)
	return Edff

@jit(complex128(complex128[:,:],int64,int64,int64,int64,int64,int64,int64,int64,int64,int64,int64,float64,float64,float64[:],float64[:]), nopython=True, cache=True)
def Edf71(f, id, nd, i, j1, j2, k1, k2, n, m, p, q, mu, U0, dU, J):
	Edff = 0
	if (id == i and nd == 1 + n):
		if (m == p and n == q):
			Edff += 0.5*f[j1,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) - 0.5*n*f[j1,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) - 0.5*q*f[j1,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) - 0.5*f[j1,-1 + m].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) + 0.5*m*f[j1,-1 + m].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) + 0.5*p*f[j1,-1 + m].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.)
		
		if (m == p and n == q):
			Edff += 0.5*f[j2,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) - 0.5*n*f[j2,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) - 0.5*q*f[j2,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) - 0.5*f[j2,-1 + m].conjugate()*dU[j2]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) + 0.5*m*f[j2,-1 + m].conjugate()*dU[j2]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) + 0.5*p*f[j2,-1 + m].conjugate()*dU[j2]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.)
		
		if (n == p and m == q):
			Edff += -0.5*n*f[j1,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) + 0.5*p*f[j1,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) + 0.5*m*f[j1,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) - 0.5*q*f[j1,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.)
		
		if (n == p and m == q):
			Edff += -0.5*n*f[j2,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) + 0.5*p*f[j2,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) + 0.5*m*f[j2,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) - 0.5*q*f[j2,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.)
		
		if (n == q):
			Edff += 0.5*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*n*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (n == q):
			Edff += 0.5*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*n*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (m == q):
			Edff += 0.5*n*f[j1,q].conjugate()*f[k1,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[j1,q].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[j1,q].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[j1,q].conjugate()*f[k1,p].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*n*f[j1,-1 + m].conjugate()*f[k1,p].conjugate()*dU[i]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[j1,-1 + m].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[j1,-1 + m].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[j1,-1 + m].conjugate()*f[k1,p].conjugate()*dU[k1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (m == q):
			Edff += 0.5*n*f[j2,q].conjugate()*f[k2,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[j2,q].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[j2,q].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[j2,q].conjugate()*f[k2,p].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*n*f[j2,-1 + m].conjugate()*f[k2,p].conjugate()*dU[i]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[j2,-1 + m].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[j2,-1 + m].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[j2,-1 + m].conjugate()*f[k2,p].conjugate()*dU[k2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (n == p):
			Edff += -0.5*n*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[i]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[i]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[j1]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[j1]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (n == p):
			Edff += -0.5*n*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (m == p):
			Edff += -0.5*n*f[j1,-1 + m].conjugate()*f[k1,q].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[j1,-1 + m].conjugate()*f[k1,q].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[j1,-1 + m].conjugate()*f[k1,q].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[j1,-1 + m].conjugate()*f[k1,q].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[j1,-1 + m].conjugate()*f[k1,q].conjugate()*dU[k1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[j1,-1 + m].conjugate()*f[k1,q].conjugate()*dU[k1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		if (m == 2 + p):
			Edff += 0.5*n*f[j1,p].conjugate()*f[k1,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[j1,p].conjugate()*f[k1,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[j1,p].conjugate()*f[k1,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[j1,p].conjugate()*f[k1,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[j1,p].conjugate()*f[k1,q].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[j1,p].conjugate()*f[k1,q].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (m == p):
			Edff += -0.5*n*f[j2,-1 + m].conjugate()*f[k2,q].conjugate()*dU[i]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[j2,-1 + m].conjugate()*f[k2,q].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[j2,-1 + m].conjugate()*f[k2,q].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[j2,-1 + m].conjugate()*f[k2,q].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[j2,-1 + m].conjugate()*f[k2,q].conjugate()*dU[k2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[j2,-1 + m].conjugate()*f[k2,q].conjugate()*dU[k2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		if (m == 2 + p):
			Edff += 0.5*n*f[j2,p].conjugate()*f[k2,q].conjugate()*dU[i]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[j2,p].conjugate()*f[k2,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[j2,p].conjugate()*f[k2,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[j2,p].conjugate()*f[k2,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[j2,p].conjugate()*f[k2,q].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[j2,p].conjugate()*f[k2,q].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
	if (id == i and nd == p):
		if (n == p and m == q):
			Edff += 0.5*n*f[j1,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) - 0.5*p*f[j1,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) - 0.5*m*f[j1,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) + 0.5*q*f[j1,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.)
		
		if (n == p and m == q):
			Edff += 0.5*n*f[j2,q].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) - 0.5*p*f[j2,q].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) - 0.5*m*f[j2,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) + 0.5*q*f[j2,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.)
		
		if (n == p):
			Edff += 0.5*n*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[j1,-1 + m].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (n == p):
			Edff += 0.5*n*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[j1,q].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
	if (id == i and nd == q):
		if (m == 2 + p and 2 + n == q):
			Edff += -0.5*f[j1,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) + 0.5*n*f[j1,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) + 0.5*q*f[j1,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) + 0.5*f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) - 0.5*m*f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) - 0.5*p*f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.)
		
		if (m == 2 + p and 2 + n == q):
			Edff += -0.5*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) + 0.5*n*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) + 0.5*q*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) + 0.5*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) - 0.5*m*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) - 0.5*p*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.)
		
		if (2 + n == q):
			Edff += -0.5*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*n*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[j1,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (2 + n == q):
			Edff += -0.5*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*n*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[j1,-1 + m].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
	if (id == j1 and nd == -1 + m):
		if (m == p and n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) - 0.5*n*f[i,1 + n].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) - 0.5*q*f[i,1 + n].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) - 0.5*f[i,1 + n].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) + 0.5*m*f[i,1 + n].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) + 0.5*p*f[i,1 + n].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.)
		
		if (n == p and m == q):
			Edff += -0.5*n*f[i,1 + n].conjugate()*dU[i]*f[i,1 + p]*f[j1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) + 0.5*p*f[i,1 + n].conjugate()*dU[i]*f[i,1 + p]*f[j1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) + 0.5*m*f[i,1 + n].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) - 0.5*q*f[i,1 + n].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.)
		
		if (n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*n*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		if (2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*n*f[i,q].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[i,q].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,q].conjugate()*f[j2,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[i,q].conjugate()*f[j2,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[i,q].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (m == q):
			Edff += -0.5*n*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[i]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[k1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (n == p):
			Edff += 0.5*n*f[i,p].conjugate()*f[j2,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[i,p].conjugate()*f[j2,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,p].conjugate()*f[j2,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[i,p].conjugate()*f[j2,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,p].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[i,p].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*n*f[i,1 + n].conjugate()*f[j2,q].conjugate()*dU[i]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[i,1 + n].conjugate()*f[j2,q].conjugate()*dU[i]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,1 + n].conjugate()*f[j2,q].conjugate()*dU[j1]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[i,1 + n].conjugate()*f[j2,q].conjugate()*dU[j1]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[i,1 + n].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (m == p):
			Edff += -0.5*n*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[k1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[k1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
	return Edff

@jit(complex128(complex128[:,:],int64,int64,int64,int64,int64,int64,int64,int64,int64,int64,int64,float64,float64,float64[:],float64[:]), nopython=True, cache=True)
def Edf72(f, id, nd, i, j1, j2, k1, k2, n, m, p, q, mu, U0, dU, J):
	Edff = 0
	if (id == j1 and nd == p):
		if (m == 2 + p and 2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) + 0.5*n*f[i,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) + 0.5*q*f[i,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) + 0.5*f[i,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) - 0.5*m*f[i,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) - 0.5*p*f[i,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.)
		
		if (n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*n*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		if (2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*n*f[i,q].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[i,q].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[i,q].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,q].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[i,q].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (m == 2 + p):
			Edff += 0.5*n*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[i,1 + n].conjugate()*f[k1,q].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
	if (id == j1 and nd == q):
		if (n == p and m == q):
			Edff += 0.5*n*f[i,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) - 0.5*p*f[i,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) - 0.5*m*f[i,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.) + 0.5*q*f[i,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[j1],2.)
		
		if (m == q):
			Edff += 0.5*n*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[i,1 + n].conjugate()*f[k1,p].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (n == p):
			Edff += 0.5*n*f[i,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[i,p].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[i,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[i,p].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*n*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
	if (id == j2 and nd == -1 + m):
		if (m == p and n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*dU[i]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) - 0.5*n*f[i,1 + n].conjugate()*dU[i]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) - 0.5*q*f[i,1 + n].conjugate()*dU[i]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) - 0.5*f[i,1 + n].conjugate()*dU[j2]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) + 0.5*m*f[i,1 + n].conjugate()*dU[j2]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) + 0.5*p*f[i,1 + n].conjugate()*dU[j2]*f[i,-1 + q]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.)
		
		if (n == p and m == q):
			Edff += -0.5*n*f[i,1 + n].conjugate()*dU[i]*f[i,1 + p]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) + 0.5*p*f[i,1 + n].conjugate()*dU[i]*f[i,1 + p]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) + 0.5*m*f[i,1 + n].conjugate()*dU[j2]*f[i,1 + p]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) - 0.5*q*f[i,1 + n].conjugate()*dU[j2]*f[i,1 + p]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.)
		
		if (n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*n*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[i]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[j2]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[j2]*f[i,-1 + q]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		if (2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*f[j1,p].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*n*f[i,q].conjugate()*f[j1,p].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[i,q].conjugate()*f[j1,p].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[i,q].conjugate()*f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,q].conjugate()*f[j1,p].conjugate()*dU[j2]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[i,q].conjugate()*f[j1,p].conjugate()*dU[j2]*f[i,n]*f[j1,1 + p]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (m == q):
			Edff += -0.5*n*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[i]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[k2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (n == p):
			Edff += 0.5*n*f[i,p].conjugate()*f[j1,q].conjugate()*dU[i]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[i,p].conjugate()*f[j1,q].conjugate()*dU[i]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,p].conjugate()*f[j1,q].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[i,p].conjugate()*f[j1,q].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,p].conjugate()*f[j1,q].conjugate()*dU[j2]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[i,p].conjugate()*f[j1,q].conjugate()*dU[j2]*f[i,n]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*n*f[i,1 + n].conjugate()*f[j1,q].conjugate()*dU[i]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[i,1 + n].conjugate()*f[j1,q].conjugate()*dU[i]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[j1,q].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[i,1 + n].conjugate()*f[j1,q].conjugate()*dU[j1]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,1 + n].conjugate()*f[j1,q].conjugate()*dU[j2]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[i,1 + n].conjugate()*f[j1,q].conjugate()*dU[j2]*f[i,1 + p]*f[j1,-1 + q]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (m == p):
			Edff += -0.5*n*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[i]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[k2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[k2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
	if (id == j2 and nd == p):
		if (m == 2 + p and 2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) + 0.5*n*f[i,q].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) + 0.5*q*f[i,q].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) + 0.5*f[i,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) - 0.5*m*f[i,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) - 0.5*p*f[i,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.)
		
		if (n == q):
			Edff += 0.5*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*n*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j2]*f[i,-1 + q]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		if (2 + n == q):
			Edff += -0.5*f[i,q].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*n*f[i,q].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[i,q].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,q].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[i,q].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[i,q].conjugate()*f[j1,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (m == 2 + p):
			Edff += 0.5*n*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[i]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[i,1 + n].conjugate()*f[k2,q].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
	if (id == j2 and nd == q):
		if (n == p and m == q):
			Edff += 0.5*n*f[i,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) - 0.5*p*f[i,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) - 0.5*m*f[i,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.) + 0.5*q*f[i,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*g(n,m)*g(-1 + q,1 + p)*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)*pow(J[i],2.)
		
		if (m == q):
			Edff += 0.5*n*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[i,1 + n].conjugate()*f[k2,p].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		
		if (n == p):
			Edff += 0.5*n*f[i,p].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[i,p].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,p].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[i,p].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,p].conjugate()*f[j1,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[i,p].conjugate()*f[j1,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*n*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j2]*f[i,1 + p]*f[j1,m]*f[j2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
	if (id == k1 and nd == p):
		if (m == q):
			Edff += 0.5*n*f[i,1 + n].conjugate()*f[j1,q].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[i,1 + n].conjugate()*f[j1,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[i,1 + n].conjugate()*f[j1,q].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[i,1 + n].conjugate()*f[j1,q].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*n*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[k1]*f[i,n]*f[j1,-1 + q]*f[k1,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
	if (id == k1 and nd == q):
		if (m == p):
			Edff += -0.5*n*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[i]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[j1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[k1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[i,1 + n].conjugate()*f[j1,-1 + m].conjugate()*dU[k1]*f[i,n]*f[j1,1 + p]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		if (m == 2 + p):
			Edff += 0.5*n*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[i]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[j1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[i,1 + n].conjugate()*f[j1,p].conjugate()*dU[k1]*f[i,n]*f[j1,m]*f[k1,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[j1]*J[k1]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
	if (id == k2 and nd == p):
		if (m == q):
			Edff += 0.5*n*f[i,1 + n].conjugate()*f[j2,q].conjugate()*dU[i]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[i,1 + n].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[i,1 + n].conjugate()*f[j2,q].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[i,1 + n].conjugate()*f[j2,q].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*n*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[k2]*f[i,n]*f[j2,-1 + q]*f[k2,1 + p]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
	if (id == k2 and nd == q):
		if (m == p):
			Edff += -0.5*n*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[i]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*m*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*p*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[j2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[k2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*q*f[i,1 + n].conjugate()*f[j2,-1 + m].conjugate()*dU[k2]*f[i,n]*f[j2,1 + p]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
		if (m == 2 + p):
			Edff += 0.5*n*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[i]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*m*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*p*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[j2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) - 0.5*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.) + 0.5*q*f[i,1 + n].conjugate()*f[j2,p].conjugate()*dU[k2]*f[i,n]*f[j2,m]*f[k2,-1 + q]*g(n,m)*g(-1 + q,1 + p)*J[i]*J[j2]*pow(1 - m + n,-1.)*pow(U0,-1.)*pow((1 - m + n)*U0 + (-1 - p + q)*U0,-1.)
	return Edff

@jit(complex128(complex128[:,:],int64,int64,int64,int64,float64,float64,float64[:],float64[:]), nopython=True, cache=True)
def Edf(f, id, nd, L, nmax, mu, U0, dU, J):
	Edff = 0

	for i in range(L):
		k1 = (i-2) % L
		j1 = (i-1) % L
		j2 = (i+1) % L
		k2 = (i+2) % L
		for n in range(nmax+1):
			Edff += Edf1(f, id, nd, i, n, mu, U0, dU, J)
			if n < nmax:
				Edff += Edf2(f, id, nd, i, j1, j2, n, mu, U0, dU, J)
				for m in range(1, nmax+1):
					if n != m-1:
						Edff += Edf3(f, id, nd, i, j1, j2, n, m, mu, U0, dU, J)
						for p in range(nmax):
							Edff += Edf4(f, id, nd, i, j1, j2, k1, k2, n, m, p, mu, U0, dU, J)
							for q in range(1, nmax+1):
								if p != q-1:
									Edff += Edf5(f, id, nd, i, j1, j2, k1, k2, n, m, p, q, mu, U0, dU, J)
									if n-m == p-q:
										Edff += Edf6(f, id, nd, i, j1, j2, k1, k2, n, m, p, q, mu, U0, dU, J)
									else:
										Edff += Edf71(f, id, nd, i, j1, j2, k1, k2, n, m, p, q, mu, U0, dU, J)
										Edff += Edf72(f, id, nd, i, j1, j2, k1, k2, n, m, p, q, mu, U0, dU, J)

	return Edff

@jit(complex128[:](float64,complex128[:],int64,int64,float64,float64,float64,float64,float64[:],float64), nopython=True, cache=True)
def odes(t, f, L, nmax, mu, Wi, Wf, tau, xi, scale):
	fin = f.reshape((L, nmax+1))
	odesf = np.zeros_like(fin)
	W = Wt(t, Wi, Wf, tau)
	Wp = Wtp(t, Wi, Wf, tau)
	U0 = U0t(W)
	U0p = U0tp(W, Wp)
	Wxi = W * xi
	Wpxi = Wp * xi
	U = Ut(Wxi)
	dU = U - U0
	J = Jt(Wxi)
	Jp = Jtp(Wxi, Wpxi)

	for i in range(L):
		for n in range(nmax+1):
			odesf[i, n] = S1dtdf(fin, i, n, L, nmax, mu, U0, dU, J, U0p, Jp) - 1j * Edf(fin, i, n, L, nmax, mu, U0, dU, J)

	odesf /= scale
	return odesf.reshape((L*(nmax+1),))
